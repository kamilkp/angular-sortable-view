!function(a,b){"use strict";function c(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}function d(a,b){var d=c(a);d.length>0?d.after(b):a.parent().prepend(b)}function e(a,c){return a instanceof b.element&&(a=a[0]),null!==h?a[h](c):void 0}var f=b.module("angular-sortable-view",[]);f.directive("svRoot",[function(){function a(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}function b(a){return g[a]}function c(a){delete g[a]}var f,g=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(h,i,j,k){var l=j(i.svRoot)(h)||h.$id;g[l]||(g[l]=[]);var m,n,o,p,q,r,s,t=!1,u=k(i.svOnSort);i.svOnStart=i.$$element[0].attributes["sv-on-start"],i.svOnStart=i.svOnStart&&i.svOnStart.value;var v=k(i.svOnStart);if(this.sortingInProgress=function(){return f},i.svGrid){if(t="true"===i.svGrid?!0:"false"===i.svGrid?!1:null,null===t)throw"Invalid value of sv-grid attribute"}else h.$watchCollection(function(){return b(l)},function(a){t=!1;var b=a.filter(function(a){return!a.container}).map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(t=!0)})})});this.$moveUpdate=function(c,g,i,j,k,u,w){var x=i[0].getBoundingClientRect();"element"===c.tolerance&&(g={x:~~(x.left+x.width/2),y:~~(x.top+x.height/2)}),f=!0,m=[],n||(k?(n=k.clone(),n.removeClass("ng-hide")):(n=j.clone(),n.addClass("sv-visibility-hidden"),n.addClass("sv-placeholder"),n.css({height:x.height+"px",width:x.width+"px"})),s=j[0].nextSibling,j.after(n),j[0].parentNode.removeChild(j[0]),j.removeClass("sv-visibility-hidden"),q=j,o=c,p=i,v(h,{$helper:p,$part:u.model(u.scope),$index:w,$item:u.model(u.scope)[w]})),p[0].reposition({x:g.x+document.body.scrollLeft-g.offset.x*x.width,y:g.y+document.body.scrollTop-g.offset.y*x.height}),b(l).forEach(function(b){if(null==c.containment||e(b.element,c.containment)||e(b.element,c.containment+" *")){var d=b.element[0].getBoundingClientRect(),f={x:~~(d.left+d.width/2),y:~~(d.top+d.height/2)};b.container||!b.element[0].scrollHeight&&!b.element[0].scrollWidth||m.push({element:b.element,q:(f.x-g.x)*(f.x-g.x)+(f.y-g.y)*(f.y-g.y),view:b.getPart(),targetIndex:b.getIndex(),after:a(f,g,t)}),b.container&&!b.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&m.push({element:b.element,q:(f.x-g.x)*(f.x-g.x)+(f.y-g.y)*(f.y-g.y),view:b.getPart(),targetIndex:0,container:!0})}});var y=n[0].getBoundingClientRect(),z={x:~~(y.left+y.width/2),y:~~(y.top+y.height/2)};m.push({q:(z.x-g.x)*(z.x-g.x)+(z.y-g.y)*(z.y-g.y),element:n,placeholder:!0}),m.sort(function(a,b){return a.q-b.q}),m.forEach(function(a,b){0!==b||a.placeholder||a.container?0===b&&a.container?(r=a,a.element.append(n)):a.element.removeClass("sv-candidate"):(r=a,a.element.addClass("sv-candidate"),a.after?a.element.after(n):d(a.element,n))})},this.$drop=function(a,b,c){function d(){if(f=!1,n.remove(),p.remove(),s.parentNode.insertBefore(q[0],s),m=void 0,n=void 0,c=void 0,p=void 0,q=void 0,r){r.element.removeClass("sv-candidate");var d=a.model(a.scope).splice(b,1),e=r.targetIndex;r.view===a&&r.targetIndex>b&&e--,r.after&&e++,r.view.model(r.view.scope).splice(e,0,d[0]),(r.view!==a||b!==e)&&u(h,{$partTo:r.view.model(r.view.scope),$partFrom:a.model(a.scope),$item:d[0],$indexTo:e,$indexFrom:b}),h.$root.$$phase||h.$apply()}r=void 0}if(c.revert){var e=n[0].getBoundingClientRect(),g=p[0].getBoundingClientRect(),i=Math.sqrt(Math.pow(g.top-e.top,2)+Math.pow(g.left-e.left,2)),j=+c.revert*i/200;j=Math.min(j,+c.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof p[0].style[a+"transition"]&&(p[0].style[a+"transition"]="all "+j+"ms ease")}),setTimeout(d,j),p.css({top:e.top+document.body.scrollTop+"px",left:e.left+document.body.scrollLeft+"px"})}else d()},this.addToSortableElements=function(a){b(l).push(a)},this.removeFromSortableElements=function(a){var d=b(l),e=d.indexOf(a);e>-1&&(d.splice(e,1),0===d.length&&c(l))}}]}}]),f.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){a.$ctrl=this,this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)}}],scope:!0,link:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,scope:b},b.$sortableRoot=e;var g={element:c,getPart:b.$ctrl.getPart,container:!0};e.addToSortableElements(g),b.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]),f.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(c,d,e,f){function g(g){function h(a){f[1].$moveUpdate(j,{x:a.clientX,y:a.clientY,offset:r},o,d,l,f[0].getPart(),c.$index)}if(!f[1].sortingInProgress()&&0==g.button){var j=a(e.svElement)(c);if(j=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},j),j.containment)var n=i.call(d,j.containment)[0].getBoundingClientRect();var o,p=d,q=d[0].getBoundingClientRect();k||(k=f[0].helper),l||(l=f[0].placeholder),k?(o=k.clone(),o.removeClass("ng-hide"),o.css({left:q.left+document.body.scrollLeft+"px",top:q.top+document.body.scrollTop+"px"}),p.addClass("sv-visibility-hidden")):(o=p.clone(),o.addClass("sv-helper").css({left:q.left+document.body.scrollLeft+"px",top:q.top+document.body.scrollTop+"px",width:q.width+"px"})),d.parent().prepend(o),o[0].reposition=function(a){var b=a.x,c=a.y,d=o[0].getBoundingClientRect(),e=document.body;n&&(c<n.top+e.scrollTop&&(c=n.top+e.scrollTop),c+d.height>n.top+e.scrollTop+n.height&&(c=n.top+e.scrollTop+n.height-d.height),b<n.left+e.scrollLeft&&(b=n.left+e.scrollLeft),b+d.width>n.left+e.scrollLeft+n.width&&(b=n.left+e.scrollLeft+n.width-d.width)),this.style.left=b-e.scrollLeft+"px",this.style.top=c-e.scrollTop+"px"};var r={x:(g.clientX-q.left)/q.width,y:(g.clientY-q.top)/q.height};m.addClass("sv-sorting-in-progress"),m.on("mousemove",h).on("mouseup",function s(){m.off("mousemove",h),m.off("mouseup",s),m.removeClass("sv-sorting-in-progress"),f[0].$drop(c.$index,j)}),h(g)}}var h={element:d,getPart:f[0].getPart,getIndex:function(){return c.$index}};f[1].addToSortableElements(h),c.$on("$destroy",function(){f[1].removeFromSortableElements(h)});var j=d;j.on("mousedown",g),c.$watch("$ctrl.handle",function(a){a&&(j.off("mousedown",g),j=a,j.on("mousedown",g))});var k;c.$watch("$ctrl.helper",function(a){a&&(k=a)});var l;c.$watch("$ctrl.placeholder",function(a){a&&(l=a)});var m=(b.element(document.body),b.element(document.documentElement))}}}]),f.directive("svHandle",function(){return{require:"?^svElement",link:function(a,b,c,d){d&&(d.handle=b)}}}),f.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-helper").addClass("ng-hide"),d[1]?d[1].helper=b:d[0]&&(d[0].helper=b)}}}),f.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-placeholder").addClass("ng-hide"),d[1]?d[1].placeholder=b:d[0]&&(d[0].placeholder=b)}}}),b.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var g=document.documentElement,h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null;if(null==h)throw"This browser doesn't support the HTMLElement.matches method";var i=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&!c[h](a);)c=c.parentNode;return c[h](a)?b.element(c):b.element()}}(window,window.angular);