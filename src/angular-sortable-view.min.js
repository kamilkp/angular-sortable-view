/*
	Copyright Kamil PÄ™kala http://github.com/kamilkp
	angular-sortable-view v0.0.13 2015/01/13
*/
!function(a,b){"use strict";function c(a){if(!("clientX"in a||"clientY"in a)){var b=a.touches||a.originalEvent.touches;b&&b.length&&(a.clientX=b[0].clientX,a.clientY=b[0].clientY),a.preventDefault()}}function d(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}function e(a,b){var c=d(a);c.length>0?c.after(b):a.parent().prepend(b)}function f(a,c){if(a instanceof b.element&&(a=a[0]),null!==i)return a[i](c)}var g=b.module("angular-sortable-view",[]);g.directive("svRoot",[function(){function a(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}function b(a){return h[a]}function c(a){delete h[a]}var d,g=!1,h=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(i,j,k,l){var m=k(j.svRoot)(i)||i.$id;h[m]||(h[m]=[]);var n,o,p,q,r,s,t=!1,u=l(j.svOnSort);j.svOnStart=j.$$element[0].attributes["sv-on-start"],j.svOnStart=j.svOnStart&&j.svOnStart.value,j.svOnStop=j.$$element[0].attributes["sv-on-stop"],j.svOnStop=j.svOnStop&&j.svOnStop.value;var v=l(j.svOnStart),w=l(j.svOnStop);if(this.sortingInProgress=function(){return d},j.svDisabled&&i.$watch(j.svDisabled,function(a){g=a===!0}),this.isDisabled=function(){return g},j.svGrid){if(t="true"===j.svGrid||"false"!==j.svGrid&&null,null===t)throw"Invalid value of sv-grid attribute"}else i.$watchCollection(function(){return b(m)},function(a){t=!1;var b=a.filter(function(a){return!a.container}).map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(t=!0)})})});this.$moveUpdate=function(c,g,h,j,k,l,u){var w=h[0].getBoundingClientRect();"element"===c.tolerance&&(g={x:~~(w.left+w.width/2),y:~~(w.top+w.height/2)}),d=!0,n=[],o||(k?(o=k.clone(),o.removeClass("ng-hide")):(o=j.clone(),o.addClass("sv-visibility-hidden"),o.addClass("sv-placeholder"),o.css({height:w.height+"px",width:w.width+"px"})),j.after(o),j.addClass("ng-hide"),r=j,p=c,q=h,v(i,{$helper:{element:q},$part:l.model(l.scope),$index:u,$item:l.model(l.scope)[u]}),i.$root&&i.$root.$$phase||i.$apply()),q[0].reposition({x:g.x+document.body.scrollLeft-g.offset.x*w.width,y:g.y+document.body.scrollTop-g.offset.y*w.height}),b(m).forEach(function(b,d){if(null==c.containment||f(b.element,c.containment)||f(b.element,c.containment+" *")){var e=b.element[0].getBoundingClientRect(),h={x:~~(e.left+e.width/2),y:~~(e.top+e.height/2)};b.container||!b.element[0].scrollHeight&&!b.element[0].scrollWidth||n.push({element:b.element,q:(h.x-g.x)*(h.x-g.x)+(h.y-g.y)*(h.y-g.y),view:b.getPart(),targetIndex:b.getIndex(),after:a(h,g,t)}),b.container&&!b.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&n.push({element:b.element,q:(h.x-g.x)*(h.x-g.x)+(h.y-g.y)*(h.y-g.y),view:b.getPart(),targetIndex:0,container:!0})}});var x=o[0].getBoundingClientRect(),y={x:~~(x.left+x.width/2),y:~~(x.top+x.height/2)};n.push({q:(y.x-g.x)*(y.x-g.x)+(y.y-g.y)*(y.y-g.y),element:o,placeholder:!0}),n.sort(function(a,b){return a.q-b.q}),n.forEach(function(a,b){0!==b||a.placeholder||a.container?0===b&&a.container?(s=a,a.element.append(o)):a.element.removeClass("sv-candidate"):(s=a,a.element.addClass("sv-candidate"),a.after?a.element.after(o):e(a.element,o))})},this.$drop=function(a,b,c){function e(){if(d=!1,o.remove(),q.remove(),r.removeClass("ng-hide"),n=void 0,o=void 0,c=void 0,q=void 0,r=void 0,w(i,{$part:a.model(a.scope),$index:b,$item:a.model(a.scope)[b]}),s){s.element.removeClass("sv-candidate");var e=a.model(a.scope).splice(b,1),f=s.targetIndex;s.view===a&&s.targetIndex>b&&f--,s.after&&f++,s.view.model(s.view.scope).splice(f,0,e[0]),s.view===a&&b===f||u(i,{$partTo:s.view.model(s.view.scope),$partFrom:a.model(a.scope),$item:e[0],$indexTo:f,$indexFrom:b})}s=void 0,i.$root&&i.$root.$$phase||i.$apply()}if(o)if(c.revert){var f=o[0].getBoundingClientRect(),g=q[0].getBoundingClientRect(),h=Math.sqrt(Math.pow(g.top-f.top,2)+Math.pow(g.left-f.left,2)),j=+c.revert*h/200;j=Math.min(j,+c.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof q[0].style[a+"transition"]&&(q[0].style[a+"transition"]="all "+j+"ms ease")}),setTimeout(e,j),q.css({top:f.top+document.body.scrollTop+"px",left:f.left+document.body.scrollLeft+"px"})}else e()},this.addToSortableElements=function(a){b(m).push(a)},this.removeFromSortableElements=function(a){var d=b(m),e=d.indexOf(a);e>-1&&(d.splice(e,1),0===d.length&&c(m))}}]}}]),g.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){a.$ctrl=this,this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)}}],scope:!0,link:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,scope:b},b.$sortableRoot=e;var g={element:c,getPart:b.$ctrl.getPart,container:!0};e.addToSortableElements(g),b.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]),g.directive("svElement",["$parse",function(d){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(e,f,g,h){function i(a){function i(b){c(b);var d=Math.abs(b.clientY-a.clientY)+Math.abs(b.clientX-a.clientX);d<10||(p||(f.parent().prepend(r),p=!0),h[1].$moveUpdate(l,{x:b.clientX,y:b.clientY,offset:v},r,f,o,h[0].getPart(),e.$index))}if(c(a),!(h[1].isDisabled()||h[1].sortingInProgress()||0!=a.button&&"mousedown"===a.type)){p=!1;var l=d(g.svElement)(e);if(l=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},l),l.containment)var m=j.call(f,l.containment)[0].getBoundingClientRect();var r,s=f,t=f[0].getBoundingClientRect(),u=k(f[0]);n||(n=h[0].helper),o||(o=h[0].placeholder),n?(r=n.clone(),r.removeClass("ng-hide"),r.css({left:t.left+document.body.scrollLeft+"px",top:t.top+document.body.scrollTop+"px"}),s.addClass("sv-visibility-hidden")):(r=s.clone(),r.addClass("sv-helper").css({left:t.left+document.body.scrollLeft+"px",top:t.top+document.body.scrollTop+"px",width:t.width+"px"})),r[0].reposition=function(a){var b=a.x,c=a.y,d=r[0].getBoundingClientRect(),e=document.body;m&&(c<m.top+e.scrollTop&&(c=m.top+e.scrollTop),c+d.height>m.top+e.scrollTop+m.height&&(c=m.top+e.scrollTop+m.height-d.height),b<m.left+e.scrollLeft&&(b=m.left+e.scrollLeft),b+d.width>m.left+e.scrollLeft+m.width&&(b=m.left+e.scrollLeft+m.width-d.width),u&&(b-=u.left,c-=u.top)),this.style.left=b-e.scrollLeft+"px",this.style.top=c-e.scrollTop+"px"};var v={x:(a.clientX-t.left)/t.width,y:(a.clientY-t.top)/t.height};q.addClass("sv-sorting-in-progress"),q.on("mousemove touchmove",i).on("mouseup touchend touchcancel",function a(b){q.off("mousemove touchmove",i),q.off("mouseup touchend touchcancel",a),q.removeClass("sv-sorting-in-progress"),p&&h[0].$drop(e.$index,l),f.removeClass("sv-visibility-hidden")})}}function k(b){for(;b!==document.documentElement;){b=b.parentNode;var c=a.getComputedStyle(b,null).position;if(""!=c&&"static"!=c)return b.getBoundingClientRect()}}var l={element:f,getPart:h[0].getPart,getIndex:function(){return e.$index}},m=f;h[1].addToSortableElements(l),e.$on("$destroy",function(){h[1].removeFromSortableElements(l),m.off("mousedown touchstart",i)}),m.on("mousedown touchstart",i),e.$watch("$ctrl.handle",function(a){a&&(m.off("mousedown touchstart",i),m=a,m.on("mousedown touchstart",i))});var n;e.$watch("$ctrl.helper",function(a){a&&(n=a)});var o;e.$watch("$ctrl.placeholder",function(a){a&&(o=a)});var p,q=(b.element(document.body),b.element(document.documentElement))}}}]),g.directive("svHandle",function(){return{require:"?^svElement",link:function(a,b,c,d){d&&(d.handle=b.add(d.handle))}}}),g.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-helper").addClass("ng-hide"),d[1]?d[1].helper=b:d[0]&&(d[0].helper=b)}}}),g.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-placeholder").addClass("ng-hide"),d[1]?d[1].placeholder=b:d[0]&&(d[0].placeholder=b)}}}),b.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var h=document.documentElement,i=h.matches?"matches":h.matchesSelector?"matchesSelector":h.webkitMatches?"webkitMatches":h.webkitMatchesSelector?"webkitMatchesSelector":h.msMatches?"msMatches":h.msMatchesSelector?"msMatchesSelector":h.mozMatches?"mozMatches":h.mozMatchesSelector?"mozMatchesSelector":null;if(null==i)throw"This browser doesn't support the HTMLElement.matches method";var j=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&!c[i](a);)c=c.parentNode;return c[i](a)?b.element(c):b.element()};"function"!=typeof b.element.prototype.add&&(b.element.prototype.add=function(a){var c,d=b.element();for(a=b.element(a),c=0;c<this.length;c++)d.push(this[c]);for(c=0;c<a.length;c++)d.push(a[c]);return d})}(window,window.angular);