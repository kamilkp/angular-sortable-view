(function(F,p){function A(f){if(!("clientX"in f||"clientY"in f)){var a=f.touches||f.originalEvent.touches;a&&a.length&&(f.clientX=a[0].clientX,f.clientY=a[0].clientY);f.preventDefault()}}function B(f,a){f instanceof p.element&&(f=f[0]);if(null!==z)return f[z](a)}var g=p.module("angular-sortable-view",[]);g.directive("svRoot",[function(){function f(a){return[{x:a.left,y:a.top},{x:a.left+a.width,y:a.top},{x:a.left,y:a.top+a.height},{x:a.left+a.width,y:a.top+a.height},{x:a.left+a.width/2,y:a.top+a.height/
2}]}function a(a,b){return a.x>=b[0].x&&a.x<=b[1].x&&a.y>=b[0].y&&a.y<=b[2].y?0:Math.min.apply(Math,b.map(function(b){return(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)}))}var d,b=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(e,c,g,t){var u=g(c.svRoot)(e)||e.$id;b[u]||(b[u]=[]);var v,k,r,w,m,l=!1,D=t(c.svOnSort);c.svOnStart=c.$$element[0].attributes["sv-on-start"];c.svOnStart=c.svOnStart&&c.svOnStart.value;c.svOnStop=c.$$element[0].attributes["sv-on-stop"];
c.svOnStop=c.svOnStop&&c.svOnStop.value;var q=t(c.svOnStart),n=t(c.svOnStop);this.sortingInProgress=function(){return d};if(c.svGrid){if(l="true"===c.svGrid?!0:"false"===c.svGrid?!1:null,null===l)throw"Invalid value of sv-grid attribute";}else e.$watchCollection(function(){return b[u]},function(a){l=!1;a=a.filter(function(a){return!a.container}).map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}});var h=Object.create(null);a.forEach(function(a){h[a.part]?h[a.part].push(a.y):
h[a.part]=[a.y]});Object.keys(h).forEach(function(a){h[a].sort();h[a].forEach(function(b,f){f<h[a].length-1&&0<b&&b===h[a][f+1]&&(l=!0)})})});this.$moveUpdate=function(c,h,g,y,C,n,t){var x=g[0].getBoundingClientRect();"element"===c.tolerance&&(h={x:~~(x.left+x.width/2),y:~~(x.top+x.height/2)});d=!0;v=[];k||(C?(k=C.clone(),k.removeClass("ng-hide")):(k=y.clone(),k.addClass("sv-visibility-hidden"),k.addClass("sv-placeholder"),k.css({height:x.height+"px",width:x.width+"px"})),y.after(k),n.copyMode||y.addClass("ng-hide"),
w=y,r=g,q(e,{$helper:{element:r},$part:n.model(n.scope),$index:t,$item:n.model(n.scope)[t]}),e.$root&&e.$root.$$phase||e.$apply());r[0].reposition({x:h.x+document.body.scrollLeft-h.offset.x*x.width,y:h.y+document.body.scrollTop-h.offset.y*x.height});b[u].forEach(function(b,x){if(null==c.containment||B(b.element,c.containment)||B(b.element,c.containment+" *")){var e=b.element[0].getBoundingClientRect(),d=f(e),k={x:~~(e.left+e.width/2),y:~~(e.top+e.height/2)},g={x:~~(e.left+e.width/2),y:~~e.top};e=
{x:~~e.left,y:~~(e.top+e.height/2)};if(!b.container&&(b.element[0].scrollHeight||b.element[0].scrollWidth)){var m=b.getPart();v.push({element:b.element,q:a(h,d),view:m,targetIndex:b.getIndex(),after:("isGrid"in m?m.isGrid:l)?0>k.x-h.x:0>k.y-h.y})}b.container&&!b.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&(d=k,"vertical"===b.centerVariant?d=e:"horizontal"===b.centerVariant&&(d=g),v.push({element:b.element,q:(d.x-h.x)*(d.x-h.x)+(d.y-h.y)*(d.y-h.y),view:b.getPart(),
targetIndex:0,container:!0}))}});g=k[0].getBoundingClientRect();v.push({q:a(h,f(g)),element:k,placeholder:!0});v.sort(function(a,b){return a.q-b.q});v.forEach(function(a,b){if(0!==b||a.placeholder||a.container)0===b&&a.container?(m=a,a.element.append(k)):a.element.removeClass("sv-candidate");else if(m=a,a.element.addClass("sv-candidate"),a.after)a.element.after(k);else{var h=a.element,e=k;var d=h[0];if(d.previousElementSibling)d=p.element(d.previousElementSibling);else{for(d=d.previousSibling;null!=
d&&1!=d.nodeType;)d=d.previousSibling;d=p.element(d)}0<d.length?d.after(e):h.parent().prepend(e)}})};this.$drop=function(a,b,f){function h(){d=!1;k.remove();r.remove();w.removeClass("ng-hide");w=r=f=k=v=void 0;n(e,{$part:a.model(a.scope),$index:b,$item:a.model(a.scope)[b]});if(m){m.element.removeClass("sv-candidate");var h=a.model(a.scope).splice(b,1),c=m.targetIndex;m.view===a&&m.targetIndex>b&&c--;m.after&&c++;m.view.model(m.view.scope).splice(c,0,h[0]);m.view===a&&b===c||D(e,{$partTo:m.view.model(m.view.scope),
$partFrom:a.model(a.scope),$item:h[0],$indexTo:c,$indexFrom:b})}m=void 0;e.$root&&e.$root.$$phase||e.$apply()}if(k)if(!f.revert||m&&m.view&&m.view.noRevert)h();else{var c=k[0].getBoundingClientRect(),g=r[0].getBoundingClientRect(),l=+f.revert*Math.sqrt(Math.pow(g.top-c.top,2)+Math.pow(g.left-c.left,2))/200;l=Math.min(l,+f.revert);["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!==typeof r[0].style[a+"transition"]&&(r[0].style[a+"transition"]="all "+l+"ms ease")});setTimeout(h,
l);r.css({top:c.top+document.body.scrollTop+"px",left:c.left+document.body.scrollLeft+"px"})}};this.addToSortableElements=function(a){b[u].push(a)};this.removeFromSortableElements=function(a){var d=b[u];a=d.indexOf(a);-1<a&&(d.splice(a,1),0===d.length&&delete b[u])}}]}}]);g.directive("svPart",["$parse",function(f){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){a.$ctrl=this;this.getPart=function(){return a.part};this.$drop=function(d,b){a.$sortableRoot.$drop(a.part,d,b)}}],
scope:!0,link:function(a,d,b,e){if(!b.svPart)throw Error("no model provided");var c=f(b.svPart);if(!c.assign)throw Error("model not assignable");a.part={id:a.$id,element:d,model:c,copyMode:"true"===b.svCopy,noRevert:"true"===b.svNoRevert,scope:a};"isGrid"in b&&(a.part.isGrid="true"===b.isGrid);a.$sortableRoot=e;var g={element:d,getPart:a.$ctrl.getPart,container:!0,centerVariant:b.svCenter||"both"};e.addToSortableElements(g);a.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]);g.directive("svElement",
["$parse",function(f){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(a,d,b,e){function c(c){function g(b){A(b);r||(d.parent().prepend(n),r=!0);e[1].$moveUpdate(w,{x:b.clientX,y:b.clientY,offset:t},n,d,v,e[0].getPart(),a.$index)}A(c);if(!e[1].sortingInProgress()&&(0==c.button||"mousedown"!==c.type)){var l=c.target.attributes["sv-handle-disabled"];if(!l||"true"!==l.value){r=!1;var w=f(b.svElement)(a);w=p.extend({},{tolerance:"pointer",
revert:200,containment:"html"},w);if(w.containment)var q=E.call(d,w.containment)[0].getBoundingClientRect();l=d[0].getBoundingClientRect();u||(u=e[0].helper);v||(v=e[0].placeholder);if(u){var n=u.clone();n.removeClass("ng-hide");n.css({left:l.left+document.body.scrollLeft+"px",top:l.top+document.body.scrollTop+"px"});d.addClass("sv-visibility-hidden")}else n=d.clone(),n.addClass("sv-helper").css({left:l.left+document.body.scrollLeft+"px",top:l.top+document.body.scrollTop+"px",width:l.width+"px"});
n[0].reposition=function(a){var b=a.x;a=a.y;var d=n[0].getBoundingClientRect(),c=document.body;q&&(a<q.top+c.scrollTop&&(a=q.top+c.scrollTop),a+d.height>q.top+c.scrollTop+q.height&&(a=q.top+c.scrollTop+q.height-d.height),b<q.left+c.scrollLeft&&(b=q.left+c.scrollLeft),b+d.width>q.left+c.scrollLeft+q.width&&(b=q.left+c.scrollLeft+q.width-d.width));this.style.left=b-c.scrollLeft+"px";this.style.top=a-c.scrollTop+"px"};var t={x:(c.clientX-l.left)/l.width,y:(c.clientY-l.top)/l.height};k.addClass("sv-sorting-in-progress");
k.on("mousemove touchmove",g).on("mouseup touchend touchcancel",function y(b){k.off("mousemove touchmove",g);k.off("mouseup touchend touchcancel",y);k.removeClass("sv-sorting-in-progress");r&&e[0].$drop(a.$index,w);d.removeClass("sv-visibility-hidden")})}}}var g={element:d,getPart:e[0].getPart,getIndex:function(){return a.$index}};e[1].addToSortableElements(g);a.$on("$destroy",function(){e[1].removeFromSortableElements(g);k.unbind("mousemove touchmove mouseup touchend touchcancel");g.element.unbind("mousedown touchstart")});
var t=d;t.on("mousedown touchstart",c);a.$watch("$ctrl.handle",function(a){a&&(t.off("mousedown touchstart",c),t=a,t.on("mousedown touchstart",c))});var u;a.$watch("$ctrl.helper",function(a){a&&(u=a)});var v;a.$watch("$ctrl.placeholder",function(a){a&&(v=a)});p.element(document.body);var k=p.element(document.documentElement),r}}}]);g.directive("svHandle",function(){return{require:"?^svElement",link:function(f,a,d,b){b&&(b.handle=a.add(b.handle))}}});g.directive("svHelper",function(){return{require:["?^svPart",
"?^svElement"],link:function(f,a,d,b){a.addClass("sv-helper").addClass("ng-hide");b[1]?b[1].helper=a:b[0]&&(b[0].helper=a)}}});g.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(f,a,d,b){a.addClass("sv-placeholder").addClass("ng-hide");b[1]?b[1].placeholder=a:b[0]&&(b[0].placeholder=a)}}});p.element(document.head).append("<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>");
g=document.documentElement;var z=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null;if(null==z)throw"This browser doesn't support the HTMLElement.matches method";var E=p.element.prototype.closest||function(f){for(var a=this[0].parentNode;a!==document.documentElement&&!a[z](f);)a=
a.parentNode;return a[z](f)?p.element(a):p.element()};"function"!==typeof p.element.prototype.add&&(p.element.prototype.add=function(f){var a,d=p.element();f=p.element(f);for(a=0;a<this.length;a++)d.push(this[a]);for(a=0;a<f.length;a++)d.push(f[a]);return d})})(window,angular);